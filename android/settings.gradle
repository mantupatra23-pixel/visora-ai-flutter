// âš™ï¸ Visora AI Cloud â€“ Stable Flutter Gradle Configuration

pluginManagement {
    repositories {
        google()
        mavenCentral()
        gradlePluginPortal()
    }

    // âœ… Add Flutter Gradle Plugin manually (for GitHub Cloud builds)
    plugins {
        id "dev.flutter.flutter-gradle-plugin" version "1.0.0"
    }
}

// ğŸ§  Dynamically detect Flutter SDK path in GitHub Runner or Local
def flutterSdkPath = System.getenv("FLUTTER_HOME")

// ğŸ” Fallback for local or cloud builds
if (flutterSdkPath == null || flutterSdkPath.isEmpty()) {
    try {
        def proc = ["bash", "-c", "which flutter"].execute()
        proc.waitFor()
        flutterSdkPath = proc.text.trim()
        if (flutterSdkPath && flutterSdkPath.contains("/bin/flutter")) {
            flutterSdkPath = flutterSdkPath.replace("/bin/flutter", "")
        }
    } catch (Exception ignored) {
        flutterSdkPath = ""
    }
}

// ğŸ§© Print detected SDK path
if (flutterSdkPath) {
    println("âœ… Flutter SDK detected at: " + flutterSdkPath)
} else {
    println("âš ï¸ No Flutter SDK found â€” skipping includeBuild. Ensure Flutter is installed.")
}

// ğŸ§© Include Flutter SDK only if valid
if (flutterSdkPath && new File(flutterSdkPath).exists()) {
    includeBuild(flutterSdkPath)
} else {
    println("âš ï¸ Skipped includeBuild â€” using global Flutter installation.")
}

// ğŸ”§ Dependency management configuration
dependencyResolutionManagement {
    repositoriesMode.set(RepositoriesMode.PREFER_SETTINGS)
    repositories {
        google()
        mavenCentral()
        gradlePluginPortal()
    }
}

// ğŸ—ï¸ Root project info
rootProject.name = "visora_ai_flutter"
include(":app")

// ğŸ§¾ Plugin dependency confirmation
def flutterPluginsFile = new File(rootDir, "../.flutter-plugins-dependencies")
if (flutterPluginsFile.exists()) {
    println("âœ… Flutter plugin dependencies file found at: ${flutterPluginsFile}")
} else {
    println("âš ï¸ Flutter plugin dependencies missing, will regenerate automatically.")
}
